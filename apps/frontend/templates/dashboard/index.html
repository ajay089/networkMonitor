{% extends 'partial/layout.html' %}

{% block content %}
{% load static %}
{% block style %}
{% endblock %}

<!-- Page header -->
<div class="page-header d-print-none">
    <div class="container-xl">
      <div class="row g-2 align-items-center">
        <div class="col">
          <!-- Page pre-title -->
          <h2 class="page-title">
            Dashboard 
          </h2>
        </div>
        <!-- Page title actions -->
        <!-- <div class="col-auto ms-auto d-print-none">
          <div class="btn-list">
            <span class="d-none d-sm-inline">
              <a  class="btn">
                New view
              </a>
            </span>
            <a  class="btn btn-primary d-none d-sm-inline-block" data-bs-toggle="modal" data-bs-target="#modal-report">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 5l0 14" /><path d="M5 12l14 0" /></svg>
              Create new report
            </a>
            <a  class="btn btn-primary d-sm-none btn-icon" data-bs-toggle="modal" data-bs-target="#modal-report" aria-label="Create new report">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 5l0 14" /><path d="M5 12l14 0" /></svg>
            </a>
          </div>
        </div> -->
      </div>
    </div>
  </div>
  <!-- Page body -->
  <div class="page-body">
    <div class="container-xl">
      <div class="row row-deck row-cards">
        <div class="col-sm-6 col-lg-3">
          <div class="card">
            <div class="card-body">
              <div class="d-flex align-items-center">
                <div class="subheader">Current day</div>
                <div class="ms-auto lh-1">
                  <div class="dropdown">
                    <a class="text-secondary"  data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Total Traffic</a>
                   
                  </div>
                </div>
              </div>
              <div class="h1 mb-3 placeholder-glow" id="total_trafic"><div class="placeholder placeholder-xs col-2"></div></div>
              <div class="d-flex mb-2">
                <p class="mt-0 mb-0 text-sm">
                  <div class="placeholder-glow" id="last_day_trafic"><div class="placeholder placeholder-xs col-2"></div></div>
                  <span class="text-nowrap">&nbsp;&nbsp;Since last day</span>
                </p>
              </div>
              <!-- <div class="progress progress-sm">
                <div class="progress-bar bg-primary" style="width: 75%" role="progressbar" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100" aria-label="75% Complete">
                  <span class="visually-hidden">75% Complete</span>
                </div>
              </div> -->
            </div>
          </div>
        </div>
        <div class="col-sm-6 col-lg-3">
          <div class="card">
            <div class="card-body">
              <div class="d-flex align-items-center">
                <div class="subheader">Current day</div>
                <div class="ms-auto lh-1">
                  <div class="dropdown">
                    <a class="text-secondary"  data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Out-Going Requests</a>
                   
                  </div>
                </div>
              </div>
              <div class="h1 mb-3 placeholder-glow" id="total_outgoing"><div class="placeholder placeholder-xs col-2"></div></div>
              <div class="d-flex mb-2">
                <p class="mt-0 mb-0 text-sm">
                  <div class="placeholder-glow" id="last_outgoing"><div class="placeholder placeholder-xs col-2"></div></div>
                  <span class="text-nowrap">&nbsp;&nbsp;Since last day</span>
                </p>
              </div>
              <!-- <div class="progress progress-sm">
                <div class="progress-bar bg-primary" style="width: 75%" role="progressbar" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100" aria-label="75% Complete">
                  <span class="visually-hidden">75% Complete</span>
                </div>
              </div> -->
            </div>
          </div>
        </div>
        
        <div class="col-sm-6 col-lg-3">
          <div class="card">
            <div class="card-body">
              <div class="d-flex align-items-center">
                <div class="subheader">Current day</div>
                <div class="ms-auto lh-1">
                  <div class="dropdown">
                    <a class="text-secondary"  data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Incoming Requests</a>
                   
                  </div>
                </div>
              </div>
              <div class="h1 mb-3 placeholder-glow" id="total_incoming"><div class="placeholder placeholder-xs col-2"></div></div>
              <div class="d-flex mb-2">
                <p class="mt-0 mb-0 text-sm">
                  <div class="placeholder-glow" id="last_incoming"><div class="placeholder placeholder-xs col-2"></div></div>
                  <span class="text-nowrap">&nbsp;&nbsp;Since last day</span>
                </p>
              </div>
              <!-- <div class="progress progress-sm">
                <div class="progress-bar bg-primary" style="width: 75%" role="progressbar" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100" aria-label="75% Complete">
                  <span class="visually-hidden">75% Complete</span>
                </div>
              </div> -->
            </div>
          </div>
        </div>

        <div class="col-sm-6 col-lg-3">
          <div class="card">
            <div class="card-body">
              <div class="d-flex align-items-center">
                <div class="subheader">Current day</div>
                <div class="ms-auto lh-1">
                  <div class="dropdown">
                    <a class="text-secondary"  data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Login Attempts</a>
                   
                  </div>
                </div>
              </div>
              <div class="h1 mb-3 placeholder-glow" id="today_login_attempt"><div class="placeholder placeholder-xs col-2"></div></div>
              <div class="d-flex mb-2">
                <p class="mt-0 mb-0 text-sm">
                  <div class="placeholder-glow" id="last_month_login_attempt"><div class="placeholder placeholder-xs col-2"></div></div>
                  <span class="text-nowrap">&nbsp;&nbsp;Since last month</span>
                </p>
              </div>
              <!-- <div class="progress progress-sm">
                <div class="progress-bar bg-primary" style="width: 75%" role="progressbar" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100" aria-label="75% Complete">
                  <span class="visually-hidden">75% Complete</span>
                </div>
              </div> -->
            </div>
          </div>
        </div>

        <div class="col-lg-6">
          <div class="card">
            <div class="card-body">
              <h3 class="card-title">Traffic summary</h3>
              <div id="chart-mentions" class="chart-lg"></div>
            </div>
          </div>
        </div>
       
        
        <div class="col-lg-6">
          <div class="card">
            <div class="card-header border-0">
              <div class="card-title">Bandwidth Consumptions(Last Seven Days)</div>
            </div>
            <div class="position-relative">
              <div class="position-absolute top-0 left-0 px-3 mt-1 w-75">
                <div class="row g-2">
                  <div class="col-auto">
                    <div class="chart-sparkline chart-sparkline-square" id="sparkline-activity"></div>
                  </div>
                  <div class="col">
                    <!-- <div>Today's Earning: $4,262.40</div> -->
                    <!-- <div class="text-secondary">
                      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-inline text-green" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 17l6 -6l4 4l8 -8" /><path d="M14 7l7 0l0 7" />
                      </svg>
                      +5% more than yesterday
                    </div> -->
                  </div>
                </div>
              </div>
              <div id="bandwidth-chart">
                <div class="card-body text-end placeholder-glow">
                  <div class="placeholder col-9 mb-3"></div>
                  <div class="placeholder placeholder-xs col-10"></div>
                  <div class="placeholder placeholder-xs col-12"></div>
                  <div class="placeholder placeholder-xs col-11"></div>
                  <div class="placeholder placeholder-xs col-8"></div>
                  <div class="placeholder placeholder-xs col-10"></div>
                </div>
              </div>
            </div>
           
          </div>
        </div>
       
       
      </div>
    </div>
  </div>


{% endblock content %}
{% block script %}
<!-- Libs JS -->
<script src="{% static 'dist/libs/apexcharts/dist/apexcharts.min.js' %}" defer></script>
<script src="{% static 'dist/libs/jsvectormap/dist/js/jsvectormap.min.js' %}" defer></script>
<script src="{% static 'dist/libs/jsvectormap/dist/maps/world.js' %}" defer></script>
<script src="{% static 'dist/libs/jsvectormap/dist/maps/world-merc.js' %}" defer></script>
<!-- Tabler Core -->
<script src="{% static 'dist/js/tabler.min.js' %}" defer></script>
<script src="{% static 'dist/js/demo.min.js' %}" defer></script>

<script>
  function getData(){
    var placeholder = '<div class="placeholder placeholder-xs col-2"></div>';
     $('#total_trafic').html(placeholder);
     $('#last_day_trafic').html(placeholder);

     $('#total_outgoing').html(placeholder);
     $('#last_outgoing').html(placeholder);

     $('#total_incoming').html(placeholder);
     $('#last_incoming').html(placeholder);
     
     $('#today_login_attempt').html(placeholder);
     $('#last_month_login_attempt').html(placeholder);

     var placeholder_bandwidth = '<div class="card-body text-end placeholder-glow"><div class="placeholder col-9 mb-3"></div><div class="placeholder placeholder-xs col-10"></div><div class="placeholder placeholder-xs col-12"></div><div class="placeholder placeholder-xs col-11"></div><div class="placeholder placeholder-xs col-8"></div><div class="placeholder placeholder-xs col-10"></div></div>';
     $('#bandwidth-chart').html(placeholder_bandwidth);

      var api_url = '{{api_url}}';
      var token = '{{token}}';  // Replace with the user's authentication token

      $.ajax({
          url: api_url,
          type: 'GET',
          headers: {
              'Authorization': token
          },
          success: function(data) {
              // // Handle successful response
              // console.log('API Response:', data);

              // Total Trafic
              $('#total_trafic').html(data.totalCountToday);
              if (data.isTotalCountGreater){
                var last_day_trafic = '<span class="text-success mr-2"><i class="fa fa-arrow-up"></i>'+data.pctChangeTotalCount+'%</span>';
              }else{
                var last_day_trafic = '<span class="text-success mr-2"><i class="fa fa-arrow-down"></i>0%</span>';
              }
              $('#last_day_trafic').html(last_day_trafic);
              
              //Outgoing
              $('#total_outgoing').html(data.totalOutgoingToday);
              if (data.isTotalOutgoingGreater){
                var last_outgoing = '<span class="text-success mr-2"><i class="fa fa-arrow-up"></i>'+data.pctChangeTotalOutgoing+'%</span>';
              }else{
                var last_outgoing = '<span class="text-success mr-2"><i class="fa fa-arrow-down"></i>0%</span>';
              }
              $('#last_outgoing').html(last_outgoing);
              
              //Incoming
              $('#total_incoming').html(data.totalIncomingToday);
              if (data.isTotalIncomingGreater){
                var last_incoming = '<span class="text-success mr-2"><i class="fa fa-arrow-up"></i>'+data.pctChangeTotalIncoming+'%</span>';
              }else{
                var last_incoming = '<span class="text-success mr-2"><i class="fa fa-arrow-down"></i>0%</span>';
              }
              $('#last_incoming').html(last_incoming);

              //Login Attempts
              $('#today_login_attempt').html(data.loginAttemptsToday+'%');
              if (data.isLoginAttemptsGreater){
                var last_month_login_attempt = '<span class="text-success mr-2"><i class="fa fa-arrow-up"></i>'+data.pctChangeLoginAttempts+'%</span>';
              }else{
                var last_month_login_attempt = '<span class="text-success mr-2"><i class="fa fa-arrow-down"></i>0%</span>';
              }
              $('#last_month_login_attempt').html(last_month_login_attempt);
              
              //Clear Placeholder
              $('#bandwidth-chart').html('');
              // Call function to update ApexCharts with data
              updateApexChart(data.bandwidthData);

          },
          error: function(xhr, status, error) {
              // Handle errors
              openToaster("warning", error);  // Display an error message
          }
      });
  }
    $(document).ready(function() {
      var html = '<div class="text-center">';
          html += '<div class="mb-12">Dashbaord Data Loading...</div>';
          html += '<div class="progress progress-sm">';
          html += '<div class="progress-bar progress-bar-indeterminate"></div>';
          html += '</div>';
          html += '</div>';
      getData();
      // Set interval to call every 5 seconds
        setInterval(function() {
          openToaster("success", html);
          // Call your function here
          getData(); // Replace with your actual function name
        }, 10000); // 5000 milliseconds = 5 seconds
    });
    
  </script>
  
 
  <script>
    // @formatter:off
    document.addEventListener("DOMContentLoaded", function () {
        window.ApexCharts && (new ApexCharts(document.getElementById('chart-mentions'), {
            chart: {
                type: "bar",
                fontFamily: 'inherit',
                height: 240,
                parentHeightOffset: 0,
                toolbar: {
                    show: false,
                },
                animations: {
                    enabled: false
                },
                stacked: true,
            },
            plotOptions: {
                bar: {
                    columnWidth: '50%',
                }
            },
            dataLabels: {
                enabled: false,
            },
            fill: {
                opacity: 1,
            },
            series: [{
                name: "Web",
                data: [1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 2, 12, 5, 8, 22, 6, 8, 6, 4, 1, 8, 24, 29, 51, 40, 47, 23, 26, 50, 26, 41, 22, 46, 47, 81, 46, 6]
            },{
                name: "Social",
                data: [2, 5, 4, 3, 3, 1, 4, 7, 5, 1, 2, 5, 3, 2, 6, 7, 7, 1, 5, 5, 2, 12, 4, 6, 18, 3, 5, 2, 13, 15, 20, 47, 18, 15, 11, 10, 0]
            },{
                name: "Other",
                data: [2, 9, 1, 7, 8, 3, 6, 5, 5, 4, 6, 4, 1, 9, 3, 6, 7, 5, 2, 8, 4, 9, 1, 2, 6, 7, 5, 1, 8, 3, 2, 3, 4, 9, 7, 1, 6]
            }],
            tooltip: {
                theme: 'dark'
            },
            grid: {
                padding: {
                    top: -20,
                    right: 0,
                    left: -4,
                    bottom: -4
                },
                strokeDashArray: 4,
                xaxis: {
                    lines: {
                        show: true
                    }
                },
            },
            xaxis: {
                labels: {
                    padding: 0,
                },
                tooltip: {
                    enabled: false
                },
                axisBorder: {
                    show: false,
                },
                type: 'datetime',
            },
            yaxis: {
                labels: {
                    padding: 4
                },
            },
            labels: [
                '2020-06-20', '2020-06-21', '2020-06-22', '2020-06-23', '2020-06-24', '2020-06-25', '2020-06-26', '2020-06-27', '2020-06-28', '2020-06-29', '2020-06-30', '2020-07-01', '2020-07-02', '2020-07-03', '2020-07-04', '2020-07-05', '2020-07-06', '2020-07-07', '2020-07-08', '2020-07-09', '2020-07-10', '2020-07-11', '2020-07-12', '2020-07-13', '2020-07-14', '2020-07-15', '2020-07-16', '2020-07-17', '2020-07-18', '2020-07-19', '2020-07-20', '2020-07-21', '2020-07-22', '2020-07-23', '2020-07-24', '2020-07-25', '2020-07-26'
            ],
            colors: [tabler.getColor("primary"), tabler.getColor("primary", 0.8), tabler.getColor("green", 0.8)],
            legend: {
                show: false,
            },
        })).render();
    });
    // @formatter:on
  </script>

  <script>
    // @formatter:off
    document.addEventListener("DOMContentLoaded", function () {
        window.ApexCharts && (new ApexCharts(document.getElementById('sparkline-activity'), {
            chart: {
                type: "radialBar",
                fontFamily: 'inherit',
                height: 40,
                width: 40,
                animations: {
                    enabled: false
                },
                sparkline: {
                    enabled: true
                },
            },
            tooltip: {
                enabled: false,
            },
            plotOptions: {
                radialBar: {
                    hollow: {
                        margin: 0,
                        size: '75%'
                    },
                    track: {
                        margin: 0
                    },
                    dataLabels: {
                        show: false
                    }
                }
            },
            colors: [tabler.getColor("blue")],
            series: [35],
        })).render();
    });
    // @formatter:on
  </script>
  <script>
    function updateApexChart(bandwidthData) {
    // Extract keys (dates) and values (bandwidth data) into arrays
      var dates = [];
      var bandwidthValues = [];

      for (var date in bandwidthData) {
          if (bandwidthData.hasOwnProperty(date)) {
              dates.push(date);
              bandwidthValues.push(bandwidthData[date]);
          }
      }

      // Initialize ApexCharts with dynamic data
      new ApexCharts(document.getElementById('bandwidth-chart'), {
          chart: {
              type: "area",
              fontFamily: 'inherit',
              height: 260,
              sparkline: {
                  enabled: true
              },
              animations: {
                  enabled: false
              },
          },
          dataLabels: {
              enabled: false,
          },
          fill: {
              opacity: .16,
              type: 'solid'
          },
          stroke: {
              width: 2,
              lineCap: "round",
              curve: "smooth",
          },
          series: [{
              name: "Bandwidth",
              data: bandwidthValues // Use bandwidthValues array for chart data
          }],
          tooltip: {
              theme: 'dark'
          },
          grid: {
              strokeDashArray: 4,
          },
          xaxis: {
              labels: {
                  padding: 0,
              },
              tooltip: {
                  enabled: false
              },
              axisBorder: {
                  show: false,
              },
              type: 'datetime',
              categories: dates // Use dates array for x-axis categories
          },
          yaxis: {
              labels: {
                  padding: 4
              },
          },
          colors: [tabler.getColor("primary")],
          legend: {
              show: false,
          },
          point: {
              show: false
          },
      }).render();
}
    
  </script>

{% endblock %}